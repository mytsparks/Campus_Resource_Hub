{% extends "base.html" %}
{% block title %}Home - Resource Search{% endblock %}
{% block content %}
<div class="flex flex-col md:flex-row gap-6 min-h-screen">
    <!-- Left Sidebar - Filters (40% width) -->
    <aside class="w-full md:w-2/5 lg:w-2/5 bg-white shadow-lg rounded-lg p-6 h-fit md:sticky md:top-20">
        <!-- Filters Header -->
        <div class="bg-indigo-600 text-white px-4 py-3 rounded-lg mb-6">
            <h2 class="text-lg font-bold">Filters</h2>
        </div>
        
        <!-- Filter Form -->
        <form action="{{ url_for('resources.list_resources') }}" method="GET" class="space-y-6">
            <!-- Search -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                <div class="relative">
                    <input type="text" 
                           name="q" 
                           value="{{ search_term or '' }}" 
                           placeholder="Search resources..." 
                           class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <!-- Categories -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Categories</label>
                <select name="category" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E')] bg-no-repeat bg-right pr-10">
                    <option value="">All categories</option>
                    <option value="Study Room" {% if category == 'Study Room' %}selected{% endif %}>Study Room</option>
                    <option value="Meeting Space" {% if category == 'Meeting Space' %}selected{% endif %}>Meeting Space</option>
                    <option value="Lab Equipment" {% if category == 'Lab Equipment' %}selected{% endif %}>Lab Equipment</option>
                    <option value="AV Equipment" {% if category == 'AV Equipment' %}selected{% endif %}>AV Equipment</option>
                    <option value="Event Space" {% if category == 'Event Space' %}selected{% endif %}>Event Space</option>
                    <option value="Classroom" {% if category == 'Classroom' %}selected{% endif %}>Classroom</option>
                    <option value="Laboratory" {% if category == 'Laboratory' %}selected{% endif %}>Laboratory</option>
                </select>
            </div>
            
            <!-- Location -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                <select name="location" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E')] bg-no-repeat bg-right pr-10">
                    <option value="">All locations</option>
                    <option value="Building A" {% if location == 'Building A' %}selected{% endif %}>Building A</option>
                    <option value="Building B" {% if location == 'Building B' %}selected{% endif %}>Building B</option>
                    <option value="Building C" {% if location == 'Building C' %}selected{% endif %}>Building C</option>
                    <option value="Library" {% if location == 'Library' %}selected{% endif %}>Library</option>
                </select>
            </div>
            
            <!-- Minimum Capacity -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Capacity</label>
                <div class="flex items-center">
                    <input type="number" 
                           name="capacity" 
                           value="{{ capacity or '' }}" 
                           placeholder="e.g. 20" 
                           min="1" 
                           class="w-full p-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <div class="flex flex-col border border-l-0 border-gray-300 rounded-r-lg">
                        <button type="button" onclick="incrementCapacity()" class="px-2 py-1 border-b border-gray-300 hover:bg-gray-100">
                            <i class="fas fa-chevron-up text-xs text-gray-600"></i>
                        </button>
                        <button type="button" onclick="decrementCapacity()" class="px-2 py-1 hover:bg-gray-100">
                            <i class="fas fa-chevron-down text-xs text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sort By -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                <select name="sort" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3E%3Cpolyline points=%276 9 12 15 18 9%27%3E%3C/polyline%3E%3C/svg%3E')] bg-no-repeat bg-right pr-10">
                    <option value="name" {% if sort_by == 'name' or not sort_by %}selected{% endif %}>Name (A-Z)</option>
                    <option value="recent" {% if sort_by == 'recent' %}selected{% endif %}>Most Recent</option>
                    <option value="most_booked" {% if sort_by == 'most_booked' %}selected{% endif %}>Most Booked</option>
                    <option value="top_rated" {% if sort_by == 'top_rated' %}selected{% endif %}>Top Rated</option>
                </select>
            </div>
            
            <!-- Advanced Search -->
            <div class="flex items-center gap-2 pt-2">
                <input type="checkbox" id="advanced" name="advanced" value="true" class="w-4 h-4 text-indigo-600">
                <label for="advanced" class="text-sm text-gray-700">Use Advanced Search (Semantic)</label>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 font-semibold transition">
                Apply Filters
            </button>
        </form>
    </aside>
    
    <!-- Right Main Content - Resource Listings (60% width) -->
    <main class="w-full md:w-3/5 lg:w-3/5 bg-gray-50 rounded-lg p-6">
        <!-- Content Header -->
        <div class="mb-6">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">
                {% if resources %}
                    {% if request.args.get('show_all') == 'true' %}
                        {% if current_user.role == 'admin' %}
                            All Resources
                        {% else %}
                            My Resources
                        {% endif %}
                    {% else %}
                        Available Resources
                    {% endif %}
                {% else %}
                    Available Resources
                {% endif %}
            </h2>
            <p class="text-gray-600">Browse and book campus resources</p>
        </div>
        
        <!-- Resource Listings (Vertical List) -->
        <div class="space-y-4">
            {% if resources %}
                {% for resource in resources %}
                <!-- Resource Card - Horizontal Layout -->
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4 flex items-center gap-4 hover:shadow-lg transition">
                    <!-- Image on Left -->
                    <div class="w-32 h-32 flex-shrink-0 rounded-lg overflow-hidden bg-gradient-to-br from-indigo-100 to-purple-100">
                        {% if resource.images %}
                            <img src="{{ resource.images.split(',')[0] if ',' in resource.images else resource.images }}" 
                                 alt="{{ resource.title }}" 
                                 class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center">
                                <i class="fas fa-image text-3xl text-indigo-300"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Details in Middle -->
                    <div class="flex-grow min-w-0">
                        <h3 class="text-lg font-bold text-gray-900 mb-1">{{ resource.title }}</h3>
                        <p class="text-sm text-gray-600 mb-3 line-clamp-1">
                            {{ resource.description or 'Modern resource with all necessary amenities' }}
                        </p>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-700">
                            {% if resource.capacity %}
                            <span class="flex items-center">
                                <i class="fas fa-users mr-2 text-indigo-600"></i>Capacity: {{ resource.capacity }}
                            </span>
                            {% endif %}
                            {% if resource.location %}
                            <span class="flex items-center">
                                <i class="fas fa-map-marker-alt mr-2 text-indigo-600"></i>{{ resource.location }}
                            </span>
                            {% endif %}
                            {% if resource.category %}
                            <span class="inline-flex items-center px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-semibold">
                                {{ resource.category }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Book Button on Right -->
                    <div class="flex-shrink-0">
                        <a href="{{ url_for('resources.resource_detail', resource_id=resource.resource_id) }}" 
                           class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold whitespace-nowrap transition shadow-md">
                            Book Resource
                        </a>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="bg-white rounded-lg shadow-md p-12 text-center">
                    <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-700 mb-2">No resources found</h3>
                    <p class="text-gray-500 mb-6">Try adjusting your search filters or browse all available resources.</p>
                    {% if current_user.is_authenticated %}
                    <a href="{{ url_for('resources.create_resource') }}" 
                       class="inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold shadow-lg">
                        <i class="fas fa-plus mr-2"></i>Create the First Resource
                    </a>
                    {% else %}
                    <a href="{{ url_for('auth.register') }}" 
                       class="inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold shadow-lg">
                        <i class="fas fa-user-plus mr-2"></i>Sign Up to Add Resources
                    </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </main>
</div>

<script>
function incrementCapacity() {
    const input = document.querySelector('input[name="capacity"]');
    const current = parseInt(input.value) || 0;
    input.value = current + 1;
}

function decrementCapacity() {
    const input = document.querySelector('input[name="capacity"]');
    const current = parseInt(input.value) || 0;
    if (current > 1) {
        input.value = current - 1;
    }
}
</script>

{% endblock %}

